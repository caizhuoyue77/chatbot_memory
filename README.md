# 网易作业：记忆与规划系统

## 项目概述
本项目旨在开发一个结合记忆功能的角色扮演对话系统。系统能够通过对话学习用户的偏好，并在后续对话中利用这些记忆提供更加个性化的回复。

## 项目展示

从对话中抽取记忆

![记忆抽取](./assets/记忆抽取.gif)

在对话中利用抽取得到的记忆

![记忆利用](./assets/记忆利用.gif)

## 启动指南

### 使用 Docker Compose 启动（推荐）

```bash
docker-compose build
```
```bash
docker-compose up
```

启动后，访问 [http://localhost:8501](http://localhost:8501) 即可使用。初次启动时，若遇到8000端口无法连接的情况，请稍等片刻。

### 本地启动(不建议，很麻烦)

1. **创建 Conda 环境并安装依赖**
    ```bash
    conda create -n chatbot-mem python==3.10
    conda activate chatbot-mem
    pip install -r requirements.txt
    ```

2. **启动后端服务**
    ```bash
    fastapi dev chat.py
    ```

3. **启动前端服务**
    ```bash
    streamlit run chat_frontend.py
    ```

## 设计说明

### 记忆抽取

1.单纯的记忆添加
通过LLM Agent+Prompt对每一轮对话进行分析，判断是否有需要抽取的记忆，抽取后进行存储

2.记忆的更新

v1.0是只有添加

v2.0现在会根据相似度进行记忆的替换和更新

v3.0（待开发）：会利用LLM来判断是否需要更新某个记忆

### 记忆利用

通过向量模型计算用户当前输入与所存储的记忆进行相似度计算，选择最相似的top k个记忆条目作为“回忆”的内容。随后会将搜索到的记忆内容添加到模型的Prompt里，让模型根据该记忆进行回答。

## 目前仍存在（但难以根除）的问题

1.


## 技术选型

- **LLM**：deepseek和moonshot
- **前端**：streamlit（界面美观）
- **后端**：fastapi（高效、易用）


## 开发进度与待办事项
- [x] 异常处理：memory.txt 不存在时的处理
- [x] 记忆筛选：根据阈值筛选记忆
- [x] 模型支持：添加 deepseek 和 moonshot 模型
- [x] 前后端改进：支持页面配置角色设定
- [x] 前后端改进：支持选择对话模型和记忆模型
- [x] 前后端改进：支持配置记忆检索阈值
- [x] 前后端改进：清空所有记忆
- [x] 拟人化回复用户
- [x] 利用 LLM 协助提取记忆
- [x] 记忆内容的向量化
- [x] 记忆存储到 txt 文件
- [x] 获取所有记忆
- [x] 计算与所有记忆的相似度
- [x] 记忆搜索功能
- [x] 记忆展示页面
- [x] 添加记忆时的提示
- [x] 提取多条记忆的对话
- [x] 处理聊天 rate limit 和资金不足的错误
- [x] Docker 化后端和模型相关部分
- [x] 向量搜索所有记忆
- [x] 在拟人回复中利用记忆
- [x] 对话页面前端
- [x] 进阶：更新记忆（相似度+prompt判断）
